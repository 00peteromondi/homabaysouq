<!-- blog/templates/blog/comment.html -->
<div class="comment {% if comment.is_reply %}comment-reply{% endif %}" id="comment-{{ comment.id }}">
    <div class="comment-author">
        <img src="{{ comment.user.profile.profile_picture.url|default:'https://placehold.co/40x40/c2c2c2/1f1f1f?text=HS' }}" 
             alt="{{ comment.user.username }}" class="comment-author-img">
        <div class="flex-grow-1">
            <h6 class="mb-0">{{ comment.user.username }}</h6>
            <small class="text-muted">{{ comment.created_at|timesince }} ago</small>
        </div>
        {% if user.is_authenticated and not comment.is_reply and post.allow_comments %}
        <button class="btn btn-sm btn-outline-secondary reply-btn" data-comment-id="{{ comment.id }}">
            <i class="bi bi-reply"></i> Reply
        </button>
        {% endif %}
    </div>
    
    <div class="comment-content mt-2">
        <p class="mb-2">{{ comment.content }}</p>
        
        {% if user == comment.user %}
        <form method="post" action="{% url 'blog:delete-comment' comment.id %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Are you sure you want to delete this comment?')">
                <i class="bi bi-trash"></i> Delete
            </button>
        </form>
        {% endif %}
    </div>

    <!-- Reply Form -->
    {% if user.is_authenticated and not comment.is_reply and post.allow_comments %}
    <form method="post" action="{% url 'blog:add-comment' post.slug %}" class="mt-3 d-none" id="reply-form-{{ comment.id }}">
        {% csrf_token %}
        <input type="hidden" name="parent_id" value="{{ comment.id }}">
        <div class="mb-2">
            <textarea name="content" class="form-control" rows="2" placeholder="Write your reply..."></textarea>
        </div>
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary btn-sm">Post Reply</button>
            <button type="button" class="btn btn-secondary btn-sm cancel-reply" data-comment-id="{{ comment.id }}">Cancel</button>
        </div>
    </form>
    {% endif %}

    <!-- Nested Replies -->
    {% for reply in comment.get_replies %}
        {% include 'blog/comment.html' with comment=reply %}
    {% endfor %}
</div>