{% extends 'base.html' %}
{% load static %}

{% block title %}OAuth Diagnostics - HomaBay Souq{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <h2>OAuth Diagnostics</h2>
      <p class="text-muted">Staff-only page showing SocialApp records, environment variables and Site settings useful when debugging Google/Facebook OAuth.</p>

      <div class="card mb-4">
        <div class="card-header">Site</div>
        <div class="card-body">
          <p><strong>Site id:</strong> {{ site.id }}</p>
          <p><strong>Domain:</strong> {{ site.domain }}</p>
          <p><strong>Name:</strong> {{ site.name }}</p>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">SocialApp records</div>
        <div class="card-body">
          {% if provider_apps %}
            <ul>
              {% for provider, app in provider_apps.items %}
                <li><strong>{{ provider }}</strong> — client_id: <code>{{ app.client_id }}</code> — secret: <em>{{ app.secret|default:'(hidden)' }}</em>
                  <br>Sites: {% for s in app.sites.all %}<code>{{ s.domain }}</code>{% if not forloop.last %}, {% endif %}{% endfor %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-warning">No SocialApp records found.</p>
          {% endif %}
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Environment Variables</div>
        <div class="card-body">
          <table class="table table-sm">
            <thead><tr><th>Variable</th><th>Value present?</th></tr></thead>
            <tbody>
              {% for k, v in env_vars.items %}
              <tr>
                <td><code>{{ k }}</code></td>
                <td>{% if v %}<span class="badge bg-success">Present</span>{% else %}<span class="badge bg-danger">Missing</span>{% endif %}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Suggested Redirect URIs</div>
        <div class="card-body">
          <p>Typical redirect URIs for Google/Facebook:</p>
          <ul>
            <li><code>http://localhost:8000/accounts/google/login/callback/</code> (local http)</li>
            <li><code>https://your-domain.com/accounts/google/login/callback/</code> (production https)</li>
            <li><code>http://localhost:8000/accounts/facebook/login/callback/</code></li>
          </ul>
          <p>If you use a different port, replace <code>8000</code> with your dev port.</p>
        </div>
      </div>

      <div class="card mb-4">
        <div class="card-header">Social Provider Config</div>
        <div class="card-body">
          <pre>{{ social_providers|safe }}</pre>
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
